<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal AI Chat - Gemini Clone</title>
<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Marked.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
  /* Custom scrollbar for chat */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: #f1f1f1; }
  ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: #555; }
  /* Dark mode overrides */
  .dark::-webkit-scrollbar-track { background: #1f2937; }
  .dark::-webkit-scrollbar-thumb { background: #374151; }
  .dark::-webkit-scrollbar-thumb:hover { background: #4b5563; }
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col relative">
<div id="loading" class="flex items-center justify-center h-screen text-gray-500 dark:text-gray-400">Loading App...</div>

<!-- Main App -->
<div id="app" class="hidden flex-1 flex overflow-hidden">
  <!-- Sidebar -->
  <div id="sidebar" class="bg-white dark:bg-gray-800 w-64 flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-700 transition-transform duration-300 transform -translate-x-64 md:translate-x-0">
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
      <h2 class="font-bold text-lg text-gray-800 dark:text-gray-100">Chats</h2>
      <button id="newChatBtn" class="px-2 py-1 bg-blue-500 text-white rounded text-sm">New</button>
    </div>
    <ul id="chatList" class="flex-1 overflow-y-auto p-2 space-y-2"></ul>
    <div class="p-4 border-t border-gray-200 dark:border-gray-700">
      <button id="settingsBtn" class="w-full px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded text-sm">Settings ‚öôÔ∏è</button>
      <button id="darkModeBtn" class="w-full mt-2 px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded text-sm">Toggle üåô</button>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="flex-1 flex flex-col relative">
    <div class="flex items-center md:hidden p-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
      <button id="hamburgerBtn" class="text-gray-800 dark:text-gray-100 text-2xl">‚ò∞</button>
      <span class="ml-2 font-semibold text-gray-800 dark:text-gray-100">AI Chat</span>
    </div>
    <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-3"></div>

    <!-- Input Bar -->
    <div class="sticky bottom-0 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-2 flex items-center">
      <input id="userInput" type="text" placeholder="Type a message..." class="flex-1 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
      <button id="sendBtn" class="ml-2 px-4 py-2 bg-blue-500 text-white rounded">Send</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-800 w-80 rounded shadow-lg p-4">
    <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100 mb-2">Settings</h3>
    <label class="block mb-2 text-gray-700 dark:text-gray-200">OpenRouter API Key</label>
    <input id="apiKeyInput" type="password" placeholder="sk-..." class="w-full mb-3 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
    <label class="block mb-2 text-gray-700 dark:text-gray-200">Model Name</label>
    <input id="modelInput" type="text" placeholder="deepseek/deepseek-r1:free" class="w-full mb-3 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
    <div class="flex justify-end space-x-2 mt-4">
      <button id="saveSettingsBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Save</button>
      <button id="closeSettingsBtn" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-100 rounded">Close</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Safety: hide loading only after JS initializes
  const app = document.getElementById('app');
  const loading = document.getElementById('loading');
  app.classList.remove('hidden');
  loading.style.display = 'none';

  // DOM elements
  const messagesEl = document.getElementById('messages');
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const chatListEl = document.getElementById('chatList');
  const newChatBtn = document.getElementById('newChatBtn');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsModal = document.getElementById('settingsModal');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const saveSettingsBtn = document.getElementById('saveSettingsBtn');
  const apiKeyInput = document.getElementById('apiKeyInput');
  const modelInput = document.getElementById('modelInput');
  const darkModeBtn = document.getElementById('darkModeBtn');
  const sidebar = document.getElementById('sidebar');
  const hamburgerBtn = document.getElementById('hamburgerBtn');

  // State
  let apiKey = localStorage.getItem('openRouterApiKey') || '';
  let modelName = localStorage.getItem('modelName') || 'deepseek/deepseek-r1:free';
  let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
  let darkMode = localStorage.getItem('darkMode') === 'true';

  // Apply dark mode
  if(darkMode) document.documentElement.classList.add('dark');

  // Render chat list
  function renderChatList(){
    chatListEl.innerHTML = '';
    chatHistory.forEach((chat,i)=>{
      const li = document.createElement('li');
      li.className = 'p-2 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer flex justify-between items-center';
      li.innerHTML = `<span>${chat.name||'Chat '+(i+1)}</span><button data-index="${i}" class="text-red-500 ml-2 text-sm">√ó</button>`;
      li.querySelector('span').addEventListener('click', ()=> loadChat(i));
      li.querySelector('button').addEventListener('click', (e)=> { e.stopPropagation(); deleteChat(i); });
      chatListEl.appendChild(li);
    });
  }

  // Load chat
  let currentChatIndex = 0;
  function loadChat(index){
    currentChatIndex = index;
    messagesEl.innerHTML = '';
    chatHistory[index].messages.forEach(m => renderMessage(m.role,m.content));
  }

  // Delete chat
  function deleteChat(index){
    chatHistory.splice(index,1);
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    renderChatList();
    if(chatHistory.length>0) loadChat(0);
    else newChat();
  }

  // New chat
  function newChat(){
    const chat = {name:'Chat '+(chatHistory.length+1), messages:[], systemPrompt:''};
    chatHistory.push(chat);
    currentChatIndex = chatHistory.length-1;
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    renderChatList();
    loadChat(currentChatIndex);
  }

  // Render single message
  function renderMessage(role,content){
    const div = document.createElement('div');
    div.className = 'max-w-[80%] px-3 py-2 rounded '+(role==='user'?'bg-blue-100 text-right self-end':'bg-gray-200 dark:bg-gray-700 self-start');
    div.innerHTML = marked.parse(content);
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // Send message
  async function sendMessage(){
    const content = userInput.value.trim();
    if(!content) return;
    userInput.value = '';
    addMessage('user',content);
    await addAIMessage(content);
  }

  function addMessage(role,content){
    renderMessage(role,content);
    chatHistory[currentChatIndex].messages.push({role,content});
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
  }

  // AI streaming response
  async function addAIMessage(userContent){
    const chat = chatHistory[currentChatIndex];
    const messages = [];
    if(chat.systemPrompt) messages.push({role:'system',content:chat.systemPrompt});
    chat.messages.forEach(m=>messages.push({role:m.role,content:m.content}));
    messages.push({role:'user',content:userContent});

    const aiDiv = document.createElement('div');
    aiDiv.className = 'max-w-[80%] px-3 py-2 rounded bg-gray-200 dark:bg-gray-700 self-start';
    messagesEl.appendChild(aiDiv);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    try {
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},
        body: JSON.stringify({model:modelName,messages})
      });
      if(!res.ok) throw new Error('API error');
      const data = await res.json();
      const text = data?.choices?.[0]?.message?.content || 'No response';
      let idx = 0;
      const interval = setInterval(()=>{
        if(idx>=text.length){ clearInterval(interval); return; }
        aiDiv.innerHTML = marked.parse(text.slice(0,idx+1));
        messagesEl.scrollTop = messagesEl.scrollHeight;
        idx++;
      },10);
      chat.messages.push({role:'assistant',content:text});
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    } catch(e){
      aiDiv.innerHTML = `<span class="text-red-500">Error: ${e.message}</span>`;
    }
  }

  // Event listeners
  sendBtn.addEventListener('click', sendMessage);
  userInput.addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });
  newChatBtn.addEventListener('click', newChat);
  settingsBtn.addEventListener('click', ()=> settingsModal.classList.remove('hidden'));
  closeSettingsBtn.addEventListener('click', ()=> settingsModal.classList.add('hidden'));
  saveSettingsBtn.addEventListener('click', ()=>{
    apiKey = apiKeyInput.value.trim();
    modelName = modelInput.value.trim()||'deepseek/deepseek-r1:free';
    localStorage.setItem('openRouterApiKey', apiKey);
    localStorage.setItem('modelName', modelName);
    settingsModal.classList.add('hidden');
    alert('Settings saved!');
  });
  darkModeBtn.addEventListener('click', ()=>{
    darkMode = !darkMode;
    if(darkMode) document.documentElement.classList.add('dark');
    else document.documentElement.classList.remove('dark');
    localStorage.setItem('darkMode',darkMode);
  });

  hamburgerBtn.addEventListener('click', ()=>{
    sidebar.classList.toggle('-translate-x-64');
  });

  // Initial load
  if(chatHistory.length===0) newChat();
  else { renderChatList(); loadChat(0); }
  apiKeyInput.value = apiKey;
  modelInput.value = modelName;
})();
</script>
</body>
</html><!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal AI Chat - Gemini Clone</title>
<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Marked.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
  /* Custom scrollbar for chat */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: #f1f1f1; }
  ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: #555; }
  /* Dark mode overrides */
  .dark::-webkit-scrollbar-track { background: #1f2937; }
  .dark::-webkit-scrollbar-thumb { background: #374151; }
  .dark::-webkit-scrollbar-thumb:hover { background: #4b5563; }
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col relative">
<div id="loading" class="flex items-center justify-center h-screen text-gray-500 dark:text-gray-400">Loading App...</div>

<!-- Main App -->
<div id="app" class="hidden flex-1 flex overflow-hidden">
  <!-- Sidebar -->
  <div id="sidebar" class="bg-white dark:bg-gray-800 w-64 flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-700 transition-transform duration-300 transform -translate-x-64 md:translate-x-0">
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
      <h2 class="font-bold text-lg text-gray-800 dark:text-gray-100">Chats</h2>
      <button id="newChatBtn" class="px-2 py-1 bg-blue-500 text-white rounded text-sm">New</button>
    </div>
    <ul id="chatList" class="flex-1 overflow-y-auto p-2 space-y-2"></ul>
    <div class="p-4 border-t border-gray-200 dark:border-gray-700">
      <button id="settingsBtn" class="w-full px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded text-sm">Settings ‚öôÔ∏è</button>
      <button id="darkModeBtn" class="w-full mt-2 px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded text-sm">Toggle üåô</button>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="flex-1 flex flex-col relative">
    <div class="flex items-center md:hidden p-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
      <button id="hamburgerBtn" class="text-gray-800 dark:text-gray-100 text-2xl">‚ò∞</button>
      <span class="ml-2 font-semibold text-gray-800 dark:text-gray-100">AI Chat</span>
    </div>
    <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-3"></div>

    <!-- Input Bar -->
    <div class="sticky bottom-0 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-2 flex items-center">
      <input id="userInput" type="text" placeholder="Type a message..." class="flex-1 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
      <button id="sendBtn" class="ml-2 px-4 py-2 bg-blue-500 text-white rounded">Send</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-800 w-80 rounded shadow-lg p-4">
    <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100 mb-2">Settings</h3>
    <label class="block mb-2 text-gray-700 dark:text-gray-200">OpenRouter API Key</label>
    <input id="apiKeyInput" type="password" placeholder="sk-..." class="w-full mb-3 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
    <label class="block mb-2 text-gray-700 dark:text-gray-200">Model Name</label>
    <input id="modelInput" type="text" placeholder="deepseek/deepseek-r1:free" class="w-full mb-3 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring focus:ring-blue-300 dark:focus:ring-blue-500">
    <div class="flex justify-end space-x-2 mt-4">
      <button id="saveSettingsBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Save</button>
      <button id="closeSettingsBtn" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-100 rounded">Close</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Safety: hide loading only after JS initializes
  const app = document.getElementById('app');
  const loading = document.getElementById('loading');
  app.classList.remove('hidden');
  loading.style.display = 'none';

  // DOM elements
  const messagesEl = document.getElementById('messages');
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const chatListEl = document.getElementById('chatList');
  const newChatBtn = document.getElementById('newChatBtn');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsModal = document.getElementById('settingsModal');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const saveSettingsBtn = document.getElementById('saveSettingsBtn');
  const apiKeyInput = document.getElementById('apiKeyInput');
  const modelInput = document.getElementById('modelInput');
  const darkModeBtn = document.getElementById('darkModeBtn');
  const sidebar = document.getElementById('sidebar');
  const hamburgerBtn = document.getElementById('hamburgerBtn');

  // State
  let apiKey = localStorage.getItem('openRouterApiKey') || '';
  let modelName = localStorage.getItem('modelName') || 'deepseek/deepseek-r1:free';
  let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
  let darkMode = localStorage.getItem('darkMode') === 'true';

  // Apply dark mode
  if(darkMode) document.documentElement.classList.add('dark');

  // Render chat list
  function renderChatList(){
    chatListEl.innerHTML = '';
    chatHistory.forEach((chat,i)=>{
      const li = document.createElement('li');
      li.className = 'p-2 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer flex justify-between items-center';
      li.innerHTML = `<span>${chat.name||'Chat '+(i+1)}</span><button data-index="${i}" class="text-red-500 ml-2 text-sm">√ó</button>`;
      li.querySelector('span').addEventListener('click', ()=> loadChat(i));
      li.querySelector('button').addEventListener('click', (e)=> { e.stopPropagation(); deleteChat(i); });
      chatListEl.appendChild(li);
    });
  }

  // Load chat
  let currentChatIndex = 0;
  function loadChat(index){
    currentChatIndex = index;
    messagesEl.innerHTML = '';
    chatHistory[index].messages.forEach(m => renderMessage(m.role,m.content));
  }

  // Delete chat
  function deleteChat(index){
    chatHistory.splice(index,1);
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    renderChatList();
    if(chatHistory.length>0) loadChat(0);
    else newChat();
  }

  // New chat
  function newChat(){
    const chat = {name:'Chat '+(chatHistory.length+1), messages:[], systemPrompt:''};
    chatHistory.push(chat);
    currentChatIndex = chatHistory.length-1;
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    renderChatList();
    loadChat(currentChatIndex);
  }

  // Render single message
  function renderMessage(role,content){
    const div = document.createElement('div');
    div.className = 'max-w-[80%] px-3 py-2 rounded '+(role==='user'?'bg-blue-100 text-right self-end':'bg-gray-200 dark:bg-gray-700 self-start');
    div.innerHTML = marked.parse(content);
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // Send message
  async function sendMessage(){
    const content = userInput.value.trim();
    if(!content) return;
    userInput.value = '';
    addMessage('user',content);
    await addAIMessage(content);
  }

  function addMessage(role,content){
    renderMessage(role,content);
    chatHistory[currentChatIndex].messages.push({role,content});
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
  }

  // AI streaming response
  async function addAIMessage(userContent){
    const chat = chatHistory[currentChatIndex];
    const messages = [];
    if(chat.systemPrompt) messages.push({role:'system',content:chat.systemPrompt});
    chat.messages.forEach(m=>messages.push({role:m.role,content:m.content}));
    messages.push({role:'user',content:userContent});

    const aiDiv = document.createElement('div');
    aiDiv.className = 'max-w-[80%] px-3 py-2 rounded bg-gray-200 dark:bg-gray-700 self-start';
    messagesEl.appendChild(aiDiv);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    try {
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},
        body: JSON.stringify({model:modelName,messages})
      });
      if(!res.ok) throw new Error('API error');
      const data = await res.json();
      const text = data?.choices?.[0]?.message?.content || 'No response';
      let idx = 0;
      const interval = setInterval(()=>{
        if(idx>=text.length){ clearInterval(interval); return; }
        aiDiv.innerHTML = marked.parse(text.slice(0,idx+1));
        messagesEl.scrollTop = messagesEl.scrollHeight;
        idx++;
      },10);
      chat.messages.push({role:'assistant',content:text});
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    } catch(e){
      aiDiv.innerHTML = `<span class="text-red-500">Error: ${e.message}</span>`;
    }
  }

  // Event listeners
  sendBtn.addEventListener('click', sendMessage);
  userInput.addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });
  newChatBtn.addEventListener('click', newChat);
  settingsBtn.addEventListener('click', ()=> settingsModal.classList.remove('hidden'));
  closeSettingsBtn.addEventListener('click', ()=> settingsModal.classList.add('hidden'));
  saveSettingsBtn.addEventListener('click', ()=>{
    apiKey = apiKeyInput.value.trim();
    modelName = modelInput.value.trim()||'deepseek/deepseek-r1:free';
    localStorage.setItem('openRouterApiKey', apiKey);
    localStorage.setItem('modelName', modelName);
    settingsModal.classList.add('hidden');
    alert('Settings saved!');
  });
  darkModeBtn.addEventListener('click', ()=>{
    darkMode = !darkMode;
    if(darkMode) document.documentElement.classList.add('dark');
    else document.documentElement.classList.remove('dark');
    localStorage.setItem('darkMode',darkMode);
  });

  hamburgerBtn.addEventListener('click', ()=>{
    sidebar.classList.toggle('-translate-x-64');
  });

  // Initial load
  if(chatHistory.length===0) newChat();
  else { renderChatList(); loadChat(0); }
  apiKeyInput.value = apiKey;
  modelInput.value = modelName;
})();
</script>
</body>
</html>
